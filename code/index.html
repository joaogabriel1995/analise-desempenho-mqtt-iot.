
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Código para Simulação - Simulação IoT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#locust" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Simulação IoT" class="md-header__button md-logo" aria-label="Simulação IoT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Simulação IoT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Código para Simulação
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Simulação IoT" class="md-nav__button md-logo" aria-label="Simulação IoT" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Simulação IoT
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../path/" class="md-nav__link">
        Estrutura de Pastas
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Código para Simulação
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Código para Simulação
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#import" class="md-nav__link">
    Import
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classe-user" class="md-nav__link">
    Classe User
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-mqtt" class="md-nav__link">
    Callbacks MQTT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#taskset" class="md-nav__link">
    TaskSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-message" class="md-nav__link">
    Class Message
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tamanho_da_amos/" class="md-nav__link">
        Definindo tamanho de amostra
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#import" class="md-nav__link">
    Import
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classe-user" class="md-nav__link">
    Classe User
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-mqtt" class="md-nav__link">
    Callbacks MQTT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#taskset" class="md-nav__link">
    TaskSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-message" class="md-nav__link">
    Class Message
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="locust">Locust</h1>
<p>Agora, vamos analisar o arquivo locustfile.py e vamos destrinchar o código.
Como podemos analisar o arquivo locust é um módulo Python normal, ele pode importar código de outros arquivos ou pacotes.</p>
<p>Nesse primeiro momento irei explicar os códigos e resultados para os testes sem a utilização do protocolo de segurança <code>Transport Layer Security</code>(TLS)</p>
<p>Segue abaixo um fluxograma reduzido de como é realizado a simulação dos nossos dispositivos.</p>
<p><img alt="alt text for screen readers" src="../image/simulacao.png" title="fluxograma" />
<em>Figura 5 - Fluxograma da simulação</em></p>
<p>Esse fluxo será realizado por nosso script que será explicado logo abaixo.</p>
<h2 id="import">Import</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">task</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">mqtt</span>
</code></pre></div>
<p>Primeiro iremos definir uma classe para os usuários que iremos simular. Essa classe herda da classe User do Locust.</p>
<p>Iremos inicializar essa classe com o nosso método construtor <code>__init__</code> e iremos utilizar <code>super()</code>, função que nos permite sobrescrever métodos e alterar comportamentos.</p>
<h2 id="classe-user">Classe User</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">class</span> <span class="nc">MQTTLocust</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="n">PublishTask</span><span class="p">}</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">_locust_environment</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="n">WAIT_TIME</span><span class="p">)</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>        <span class="n">increment</span><span class="p">()</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span> <span class="o">=</span> <span class="s2">&quot;Device - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">COUNTClient</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_connect</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">on_publish</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_publish</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<p>Aqui estamos importando o método init da classe pai, e o sobrescrevendo para adicionar nosso <code>self.client</code> que é uma instância de <code>paho.mqtt.client.Client</code>, esse cliente MQTT pode ser usado para publicar e receber mensagens. Quando o teste é iniciado, o locust criará uma instância para cada cliente que for simulado. Cada um desses clients será executado em um micro-thread.</p>
<p>O comportamento deste usuário é definido por tarefas que serão definidas mais a frente. Na linha 3 estamos mostrando para nossa classe MQTTLocust as tarefas que nossos clientes executarão.</p>
<p>Nas linhas 11 e 12 foi associada as funções de callback, essas funções são executadas em resposta a algum evento. Irei detalhar cada uma delas abaixo.</p>
<h2 id="callbacks-mqtt">Callbacks MQTT</h2>
<p>A função <code>on_connect</code> é chamada quando o Broker responde à nossa solicitação de conexão.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connect &quot;</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>A função <code>on_publish</code> é executada quando uma mensagem concluiu a transmissão para o broker. Para mensagens com níveis de QoS 1 e 2, isso significa que as mensagens foram entregues ao broker. Para QoS 0, isso significa simplesmente que a mensagem deixou o cliente.
Na linha 3 da nossa função on_publish iremos capturar o tempo em que a mensagem de confirmação chegou.</p>
<p>Na linha 8 foi vinculado a um evento que é relacionado ao Locust, esse evento é acionado quando uma solicitação é concluida, bem-sucedidade ou malsucedidade. Isso é um modo de informarmos ao locust o fim de uma solicitação, o tempo em que essa solicitação foi finalizada e possibilitando que esses valores sejam apresentadas em uma interface que o Locust possui para visualizar os resultados.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span> <span class="nf">on_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">()</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>        <span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>                             <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="n">total_time</span> <span class="o">=</span> <span class="n">time_delta</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>        <span class="n">events</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">fire</span><span class="p">(</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>            <span class="n">request_type</span><span class="o">=</span><span class="n">REQUEST_TYPE</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)),</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>            <span class="n">response_time</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>            <span class="n">response_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">payload</span><span class="p">),</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>            <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>            <span class="n">context</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>            <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>            <span class="n">start_time</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>            <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="taskset">TaskSet</h2>
<p>Classe que define um conjunto de tarefas que um usuário executará.
Aqui iremos definir duas tarefas , uma quando o teste começar os clientes irão conectar ao broker e logo em seguida irão desconecta.
Ja a segunda tarefa que foi definida é mais complexa, nessa tarefa o cliente conectará ao Broker, capturar o tempo logo após a conexão e envia uma mensagem em um tópico específico e após desconecta do broker.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">class</span> <span class="nc">PublishTask</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="k">def</span> <span class="nf">on_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">broker_address</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">PORT_HOST</span><span class="p">,</span> <span class="n">keepalive</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="k">def</span> <span class="nf">task_pub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">loop_start</span><span class="p">()</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">()</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="n">topic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">formatpayload</span><span class="p">(</span><span class="n">SIZE_PAYLOAD</span><span class="p">)</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="n">MQTTMessageInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>            <span class="n">topic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">qos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>        <span class="n">pub_mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>                                 <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>        <span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>                                             <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user_data_set</span><span class="p">(</span><span class="n">pub_mid</span><span class="p">)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span><span class="p">[</span><span class="n">pub_mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>            <span class="n">REQUEST_TYPE</span><span class="p">,</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>            <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>            <span class="n">topic</span><span class="p">,</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>            <span class="n">payload</span><span class="p">,</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>            <span class="n">PUBLISH_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="p">),</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>        <span class="p">)</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>        <span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">wait_for_publish</span><span class="p">()</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">loop_stop</span><span class="p">()</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>    <span class="k">def</span> <span class="nf">on_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>        <span class="k">global</span> <span class="n">COUNTClient</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>        <span class="n">COUNTClient</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Podemos perceber que já definimos os dois tempos que serão utilizados pelo Locust, um tempo, que é capturado assim que a mensagem vai ser enviada e um segundo tempo, que foi capturado logo após a confirmação de recebimento. Esse segundo tempo é capturado quando a função de callback on_publish é chamada.</p>
<h2 id="class-message">Class Message</h2>
<p>Temos uma classe que Message, essa classe fica responsavel por criar um objeto que temos as informações da nossa mensagem.
Isso facilita manipulação da mensagem se for necessário. Essa classe ficou alocada no arquivo <code>message.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">qos</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="p">(</span><span class="n">qos</span><span class="p">,)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>
<h1 id="utils">Utils</h1>
<p>Criamos três funções em um arquivo denominado <code>utils</code>:</p>
<ul>
<li>Uma para calcular a diferença de tempo de chegada da nossa mensagem menos o tempo de chegada da nossa confirmação de entrega.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span> <span class="nf">time_delta</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">))</span><span class="err">```</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="o">-</span> <span class="n">Uma</span> <span class="n">função</span> <span class="n">responsavel</span> <span class="n">por</span> <span class="n">capturar</span> <span class="n">o</span> <span class="n">tempo</span> <span class="n">em</span> <span class="n">um</span> <span class="n">determinado</span> <span class="n">parte</span> <span class="n">no</span> <span class="n">código</span><span class="o">.</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="err">```</span><span class="n">py</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">time_info</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="k">return</span> <span class="n">time_info</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="err">```</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="o">-</span> <span class="n">Uma</span> <span class="n">função</span> <span class="n">responsável</span> <span class="n">por</span> <span class="n">formatal</span> <span class="n">o</span> <span class="n">tamanho</span> <span class="n">do</span> <span class="n">nosso</span> <span class="n">payload</span><span class="o">.</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="err">```</span><span class="n">py</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="k">def</span> <span class="nf">formatpayload</span><span class="p">(</span><span class="n">SIZE_PAYLOAD</span><span class="p">):</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="n">SIZE_PAYLOAD</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="k">return</span> <span class="n">payload</span>
</code></pre></div>
<p>Por últimos irei definir algumas variavéis que iremos utilizar em nosso código.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">broker_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;192.168.15.3&quot;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">COUNTClient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">REQUEST_TYPE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MQTT&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">PUBLISH_TIMEOUT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">SIZE_PAYLOAD</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">PORT_HOST</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1883</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">WAIT_TIME</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div>
<p>Segue abaixo o código completo.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">locustfile.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span>
<span class="normal"><a href="#__codelineno-8-59">59</a></span>
<span class="normal"><a href="#__codelineno-8-60">60</a></span>
<span class="normal"><a href="#__codelineno-8-61">61</a></span>
<span class="normal"><a href="#__codelineno-8-62">62</a></span>
<span class="normal"><a href="#__codelineno-8-63">63</a></span>
<span class="normal"><a href="#__codelineno-8-64">64</a></span>
<span class="normal"><a href="#__codelineno-8-65">65</a></span>
<span class="normal"><a href="#__codelineno-8-66">66</a></span>
<span class="normal"><a href="#__codelineno-8-67">67</a></span>
<span class="normal"><a href="#__codelineno-8-68">68</a></span>
<span class="normal"><a href="#__codelineno-8-69">69</a></span>
<span class="normal"><a href="#__codelineno-8-70">70</a></span>
<span class="normal"><a href="#__codelineno-8-71">71</a></span>
<span class="normal"><a href="#__codelineno-8-72">72</a></span>
<span class="normal"><a href="#__codelineno-8-73">73</a></span>
<span class="normal"><a href="#__codelineno-8-74">74</a></span>
<span class="normal"><a href="#__codelineno-8-75">75</a></span>
<span class="normal"><a href="#__codelineno-8-76">76</a></span>
<span class="normal"><a href="#__codelineno-8-77">77</a></span>
<span class="normal"><a href="#__codelineno-8-78">78</a></span>
<span class="normal"><a href="#__codelineno-8-79">79</a></span>
<span class="normal"><a href="#__codelineno-8-80">80</a></span>
<span class="normal"><a href="#__codelineno-8-81">81</a></span>
<span class="normal"><a href="#__codelineno-8-82">82</a></span>
<span class="normal"><a href="#__codelineno-8-83">83</a></span>
<span class="normal"><a href="#__codelineno-8-84">84</a></span>
<span class="normal"><a href="#__codelineno-8-85">85</a></span>
<span class="normal"><a href="#__codelineno-8-86">86</a></span>
<span class="normal"><a href="#__codelineno-8-87">87</a></span>
<span class="normal"><a href="#__codelineno-8-88">88</a></span>
<span class="normal"><a href="#__codelineno-8-89">89</a></span>
<span class="normal"><a href="#__codelineno-8-90">90</a></span>
<span class="normal"><a href="#__codelineno-8-91">91</a></span>
<span class="normal"><a href="#__codelineno-8-92">92</a></span>
<span class="normal"><a href="#__codelineno-8-93">93</a></span>
<span class="normal"><a href="#__codelineno-8-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">from</span> <span class="nn">locust</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">TaskSet</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">constant</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">mqtt</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">get_time</span><span class="p">,</span> <span class="n">formatpayload</span><span class="p">,</span> <span class="n">time_delta</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">from</span> <span class="nn">message</span> <span class="kn">import</span> <span class="n">Message</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">broker_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;192.168.15.3&quot;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">COUNTClient</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="n">REQUEST_TYPE</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MQTT&quot;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="n">PUBLISH_TIMEOUT</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="n">SIZE_PAYLOAD</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="n">PORT_HOST</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1883</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="n">WAIT_TIME</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="k">def</span> <span class="nf">increment</span><span class="p">():</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>    <span class="k">global</span> <span class="n">COUNTClient</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>    <span class="n">COUNTClient</span> <span class="o">=</span> <span class="n">COUNTClient</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="k">class</span> <span class="nc">PublishTask</span><span class="p">(</span><span class="n">TaskSet</span><span class="p">):</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>    <span class="k">def</span> <span class="nf">on_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">broker_address</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">PORT_HOST</span><span class="p">,</span> <span class="n">keepalive</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>    <span class="k">def</span> <span class="nf">task_pub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">loop_start</span><span class="p">()</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">()</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>        <span class="n">topic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="p">)</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">formatpayload</span><span class="p">(</span><span class="n">SIZE_PAYLOAD</span><span class="p">)</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>        <span class="n">MQTTMessageInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>            <span class="n">topic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">qos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a>        <span class="n">pub_mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a>                                 <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>        <span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a>                                             <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">user_data_set</span><span class="p">(</span><span class="n">pub_mid</span><span class="p">)</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span><span class="p">[</span><span class="n">pub_mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a>            <span class="n">REQUEST_TYPE</span><span class="p">,</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a>            <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>            <span class="n">topic</span><span class="p">,</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a>            <span class="n">payload</span><span class="p">,</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>            <span class="n">PUBLISH_TIMEOUT</span><span class="p">,</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a>            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">_client_id</span><span class="p">),</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a>        <span class="p">)</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a>        <span class="n">MQTTMessageInfo</span><span class="o">.</span><span class="n">wait_for_publish</span><span class="p">()</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">loop_stop</span><span class="p">()</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a>    <span class="k">def</span> <span class="nf">on_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a>        <span class="k">global</span> <span class="n">COUNTClient</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>        <span class="n">COUNTClient</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_stop</span><span class="p">()</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a><span class="k">class</span> <span class="nc">MQTTLocust</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span><span class="n">PublishTask</span><span class="p">}</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a>    <span class="n">_locust_environment</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">constant</span><span class="p">(</span><span class="n">WAIT_TIME</span><span class="p">)</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>        <span class="n">increment</span><span class="p">()</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span> <span class="o">=</span> <span class="s2">&quot;Device - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">COUNTClient</span><span class="p">)</span>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)</span>
<a id="__codelineno-8-69" name="__codelineno-8-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_connect</span>
<a id="__codelineno-8-70" name="__codelineno-8-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">on_publish</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_publish</span>
<a id="__codelineno-8-71" name="__codelineno-8-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-8-72" name="__codelineno-8-72"></a>
<a id="__codelineno-8-73" name="__codelineno-8-73"></a>    <span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-8-74" name="__codelineno-8-74"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connect&quot;</span><span class="p">)</span>
<a id="__codelineno-8-75" name="__codelineno-8-75"></a>
<a id="__codelineno-8-76" name="__codelineno-8-76"></a>    <span class="k">def</span> <span class="nf">on_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
<a id="__codelineno-8-77" name="__codelineno-8-77"></a>
<a id="__codelineno-8-78" name="__codelineno-8-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">()</span>
<a id="__codelineno-8-79" name="__codelineno-8-79"></a>        <span class="n">mid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span>
<a id="__codelineno-8-80" name="__codelineno-8-80"></a>                             <span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)</span>
<a id="__codelineno-8-81" name="__codelineno-8-81"></a>
<a id="__codelineno-8-82" name="__codelineno-8-82"></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">pubmessage</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-8-83" name="__codelineno-8-83"></a>        <span class="n">total_time</span> <span class="o">=</span> <span class="n">time_delta</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
<a id="__codelineno-8-84" name="__codelineno-8-84"></a>        <span class="n">events</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">fire</span><span class="p">(</span>
<a id="__codelineno-8-85" name="__codelineno-8-85"></a>            <span class="n">request_type</span><span class="o">=</span><span class="n">REQUEST_TYPE</span><span class="p">,</span>
<a id="__codelineno-8-86" name="__codelineno-8-86"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_name</span><span class="p">)),</span>
<a id="__codelineno-8-87" name="__codelineno-8-87"></a>            <span class="n">response_time</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-8-88" name="__codelineno-8-88"></a>            <span class="n">response_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">payload</span><span class="p">),</span>
<a id="__codelineno-8-89" name="__codelineno-8-89"></a>            <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-8-90" name="__codelineno-8-90"></a>            <span class="n">context</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-8-91" name="__codelineno-8-91"></a>            <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-8-92" name="__codelineno-8-92"></a>            <span class="n">start_time</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
<a id="__codelineno-8-93" name="__codelineno-8-93"></a>            <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-8-94" name="__codelineno-8-94"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">utils.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="k">def</span> <span class="nf">time_delta</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">))</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>    <span class="n">time_info</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>    <span class="k">return</span> <span class="n">time_info</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="k">def</span> <span class="nf">formatpayload</span><span class="p">(</span><span class="n">SIZE_PAYLOAD</span><span class="p">):</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>    <span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="n">SIZE_PAYLOAD</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="k">return</span> <span class="n">payload</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">message.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span>
<span class="normal"><a href="#__codelineno-10-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">qos</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,)</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">qos</span> <span class="o">=</span> <span class="p">(</span><span class="n">qos</span><span class="p">,)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">topic</span> <span class="o">=</span> <span class="n">topic</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
<p>Agora que já foi explicado as partes mais importantes do código iremos rodar esse comando no terminal.</p>
<div class="highlight"><span class="filename">Shell</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>locust -f locustfile.py
</code></pre></div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../path/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Estrutura de Pastas" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Estrutura de Pastas
            </div>
          </div>
        </a>
      
      
        
        <a href="../tamanho_da_amos/" class="md-footer__link md-footer__link--next" aria-label="Next: Definindo tamanho de amostra" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Definindo tamanho de amostra
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.0238f547.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>